---
title: Conversions
description: An explanation of the conversion mechanism between the Quai and Qi tokens.
---

The Quai Network Protocol employs two tokens: **Quai**, the native token of an Ethereum Virtual Machine (EVM)-compatible ledger, and **Qi**, the native token of a fixed-denomination Unspent Transaction Output (UTXO) ledger. Both tokens are mineable and interconvertible by holders at a protocol-defined exchange rate. A controller mechanism ensures neutrality between Quai and Qi, preventing any inherent bias toward either token. This section details the mathematical formulations governing miner difficulty, conversion flow, exchange rate, and transaction adjustments within the protocol.

---

## **NOTE: All conversion transactions are locked up for 2 weeks**

## Core Components

### Miner Difficulty

Miner difficulty at block `i`, denoted `minerDifficulty_i`, is calculated as an Exponential Moving Average (EMA) of prime block difficulty over a 4000-block window. This balances responsiveness to network changes with long-term stability:

```math
minerDifficulty_i = (minerDifficulty_{i-1} × 3999 + blockDifficulty_i) / 4000
```

- `minerDifficulty_{i-1}`: Difficulty at the previous block.
- `blockDifficulty_i`: Difficulty of the current prime block.

This averaging smooths short-term fluctuations while adapting to evolving network conditions.

---

### Block Rewards and `k_{Qi}`

Block rewards are distributed in Quai or Qi, scaled by coefficients `k_{Quai}` and `k_{Qi}`, respectively:

- **Quai Block Reward**:  
```math
reward_{Quai} = k_{Quai} × log_2(blockDifficulty_i)
```

- **Qi Block Reward**:  
```math
reward_{Qi} = k_{Qi} × blockDifficulty_i
```

The protocol treats `k_{Qi}` as a dynamic parameter tied to hashrate efficiency, which evolves with GPU performance improvements. Based on research from [Epoch AI](https://epoch.ai/blog/predicting-gpu-performance), GPU efficiency (measured in flops) doubles every 2.69 years due to smaller transistors and increased core counts, plateauing after 2030. Assuming saturation after two doublings, `k_{Qi}` adjusts with block height (`number`):

```math
k_{Qi}(number) = 4 × baseKqi  if number > 2 × doublingPeriodInBlocks
```

```math
k_{Qi}(number) = baseKqi × 2^{doublingCount} × (1 + remainingBlocks / doublingPeriodInBlocks) if 0 ≤ number ≤ 2 × doublingPeriodInBlocks
```

Where:
- `baseKqi = 1 / (8 × 10^9)`
- `doublingPeriodInBlocks = (365 × BlocksPerDay × 269) / 100`
- `doublingCount = floor(number / doublingPeriodInBlocks)`
- `remainingBlocks = number - doublingCount × doublingPeriodInBlocks`
- `BlocksPerDay`: Constant number of blocks mined per day.

Unlike `k_{Qi}`, which adjusts to technological trends, `k_{Quai}` is actively controlled by the protocol to maintain token neutrality. All exchange rate references below pertain to `k_{Quai}`.

---

### Conversion Flow Amount and Discounts

The conversion flow amount at block `i`, `conversionFlowAmount_i`, is an EMA of Quai conversion amounts, adjusted by two discounts: a **cubic conversion flow discount** and a **K-Quai discount**. It includes a minimum threshold:

```math
conversionFlowAmount_i = max((conversionFlowAmount_{i-1} × 3999 + currentFlowAmount_i) / 4000, 100)
```

- `conversionFlowAmount_{i-1}`: Previous block’s conversion flow amount.
- `currentFlowAmount_i`: Current block’s conversion amount before the discounts.

The 100 Quai minimum conversion flow amount is maintained to keep a baseline flow. The adjusted conversion flow is also capped at 2× the previous amount.

#### Cubic Conversion Flow Discount

Each conversion transaction receives a cubic discount:

```math
valueAfterFlowDiscount = 0.998 × value  if value ≤ parentConversionFlowAmount
```

```math
valueAfterFlowDiscount = 0  if value ≥ 10 × parentConversionFlowAmount
```

```math
valueAfterFlowDiscount = (1.001 - (value / (10 × parentConversionFlowAmount))^3) × value  if parentConversionFlowAmount < value < 10 × parentConversionFlowAmount
```

#### K-Quai Discount

```math
kQuaiDiscount_i = (kQuaiDiscount_{i-1} × 3999 + min(|kQuai_i - kQuai_{i-4000}| × 100000 / kQuai_{i-4000}, 100000)) / 4000
```

```math
valueAfterKQuaiDiscount = valueAfterFlowDiscount × (100000 - kQuaiDiscount_i) / 100000
```

#### Discount Cap

```math
finalValue ≥ 0.1 × originalValue
```

#### Max Slip Specification

- **Quai-to-Qi**:
  - Max Slip default: 90% (9000 basis points)
  - Specified in first two bytes of the Data field
  - Refunds happen via `etx` in next zone block

- **Qi-to-Quai**:
  - Data field must be 22 bytes: Bytes 0–1 for slip, 2–21 for refund address
  - Refunds are locked for two weeks, 1 Qi precision

---

### Exchange Rate Calculation

```math
kQuai_i = kQuai_{i-1} + α × kQuai_{i-1} × (d* / d - 1)
```

Where:
- `kQuai_{i-1}`: Previous rate
- `α = 0.001`
- `d`: Normalized difficulty
- `d*`: Target difficulty

#### Normalized Difficulty:
```math
d = minerDifficulty_i / log_2(minerDifficulty_i)
```

#### Target Difficulty:
Simple average of adjusted difficulty over last 4000 blocks.

---

### Transaction Processing and Adjusted Difficulty

1. Coinbase Transactions: Add a choice to Quai or Qi
2. Conversion Transactions: Normalize by destination block reward

```math
adjDiff_i = minerDifficulty_i ± α × (actualAmountOfQuai - realizedAmountOfQuai) / actualAmountOfQuai × minerDifficulty_i
```

Sign depends on token choice majority.

---

## Summary

The Quai/Qi controller maintains equilibrium through interconnected mechanisms: miner difficulty adjusts to network effort, conversion flow applies stabilizing discounts, and the exchange rate evolves with normalized and target difficulties. Transaction-based adjustments further refine the system, ensuring fairness and stability in a dual-token framework. These dynamics adapt to miner behavior, conversion trends, and network activity, upholding the protocol’s neutral design.