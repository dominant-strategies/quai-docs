---
title: 多线程执行
description: Quai Network 如何并行处理交易。
---

## 从单核到多核区块链

在计算的早期，处理器一次只能处理一个任务。所有事情都必须排队等待，造成限制性能的瓶颈。多核 CPU 的发明改变了一切——计算机突然可以同时处理多个任务，释放了巨大的性能增益。Quai 将同样的革命带到区块链技术中。

传统区块链像单核处理器一样运行。每个交易都必须排队并通过一个处理通道等待轮次。在繁忙期间，这会造成大规模拥堵——就像试图将整个城市的交通挤过单车道一样。用户体验高费用、长等待时间和失败的交易。

**多核解决方案：**
Quai 的多线程执行允许多个区块链线程并行处理交易，就像现代 CPU 同时处理多个任务一样。每个区域链作为独立的执行线程运行，处理自己的交易，同时与更广泛的网络保持同步。

**Quai 如何实现这一点：**
突破来自于分离传统区块链紧密耦合的两个概念：本地一致性（区域内每个人都同意）和全局共识（整个网络都同意）。在 Quai 中：
- 区域为其交易立即实现本地共识
- 随着区块被编织到层次结构中，全局共识逐渐发生
- 用户获得快速确认，同时保持网络范围的安全性

这种架构实现了真正的并行处理——多个区域可以同时产生区块而无需等待彼此，大幅增加整体吞吐量。

<Frame>
	<img src='/images/BlockchainVisualization.webp' />
</Frame>

## 解耦一致性和全局共识

要理解 Quai 的突破，我们需要区分传统区块链混淆的两个概念。一致性意味着所有节点都有相同的数据——就像每个人都有共享文档的相同版本。共识意味着每个人都同意该版本是正确的——就像让每个人都签署该文档一样。

传统区块链强制这些同时发生。想象一下，如果每次您想保存文档时，都必须等待公司中的每个人审查和批准它。这就是比特币和以太坊的工作方式——在每个人都同意之前，什么都不能保持一致，造成大规模延迟。

**传统问题：**
在单线程区块链中，这种耦合创造了恶性循环：
1. 提出新区块
2. 网络必须在数据变得一致之前达成共识
3. 节点在共识过程中争相同步数据
4. 延迟在每个步骤都会加剧
5. 结果：缓慢的确认和有限的吞吐量

**Quai 的创新：**
Quai 通过其分层结构分离这些过程：
- **本地一致性**：区域可以立即就其自己的交易达成一致
- **渐进式共识**：协议从本地到区域到全局扩展
- **无等待**：用户获得即时本地确认，而全局共识在后台发生

**安全保证：**
这种分离不会损害安全性。Quai 维护原子回滚——如果全局共识拒绝区域状态（极其罕见），所有受影响的交易会一起回滚。这防止任何双重支付的可能性，同时实现巨大的性能增益。

结果是一个可以在几秒钟内本地处理和确认交易的系统，同时仍然保持全局共识的安全保证。这就像拥有一个保证与全局状态同步的快速本地缓存。

## 分段状态：分而治之

传统区块链要求每个节点存储所有内容——每个交易、每个账户余额、每个智能合约。这就像要求每个图书馆分馆存储整个图书馆系统中的每本书一样。这造成了巨大的低效率并限制了可扩展性。Quai 的分段状态架构完全改变了这种范式。

每个区域只维护全局状态的自己切片。将其视为公司中的专业部门——会计不需要存储工程文件，反之亦然。这种专业化在保持协调能力的同时大幅减少了需求。

**存储效率：**
在具有 N 个区域的网络中：
- 传统方法：每个节点存储 100% 的全局状态
- Quai 方法：每个区域节点仅存储约 1/N 的全局状态
- 切片节点：可以选择运行 P 个区域，仅存储总状态的 P/N

这意味着节点运营商可以使用大幅降低的硬件要求参与网络，改善去中心化。

**带宽优化：**
分段状态还彻底改变了网络效率：
- **本地交易**：留在其区域内，不需要全局广播
- **智能路由**：数据只在需要的地方传输
- **减少拥堵**：每个区域独立处理自己的流量

想象一下，如果公司中的每封电子邮件都必须发送给每位员工。这就是传统区块链的工作方式。Quai 的方法就像拥有部门邮件列表——消息只发送到相关的地方。

**快速一致性：**
分段方法实现了闪电般快速的本地一致性：
1. 区域交易实现即时本地共识
2. 哈希链接引用逐渐扩展共识范围
3. 全局共识不会干扰本地操作
4. 用户体验即时确认和最终的全局最终性

这种架构通过消除困扰单体区块链设计的瓶颈，使 Quai 能够处理50,000+ TPS。

## 并行处理：性能乘数

当您看到多线程执行的实际应用时，其真正力量变得显而易见。虽然传统区块链按顺序处理交易——在单行中一个接一个——Quai 跨多个区域并行处理它们。这就是商店中单个收银员与多个结账通道同时运行的区别。

**技术实现：**
Quai 通过为每个区域提供自己的独立写锁和计算资源来实现真正的并行处理。这意味着：
- 区域 A 可以处理 DeFi 交换
- 同时区域 B 处理 NFT 铸造
- 同时区域 C 执行游戏交易
- 所有这些都同时发生，没有干扰

**异步区块产生：**
每个区域按自己的时间表产生区块，无需等待其他区域：
- 无全局同步延迟
- 无跨区域瓶颈
- 计算资源的最大利用

**50,000 TPS 的现实：**
这种并行架构使 Quai 能够在网络中实现超过50,000次每秒交易。但与其他牺牲安全性或去中心化的高 TPS 声明不同，Quai 维护：
- 通过 [PoEM 共识](/cn/learn/advanced-introduction/poem/poem) 的完全原子性
- 所有区域的完整安全性
- 具有可访问节点要求的真正去中心化

**协调独立性：**
系统的天才在于，虽然区域为性能独立运行，但它们为安全性保持协调。如果出现任何问题（极其罕见），PoEM 共识确保所有受影响的区域一起回滚，维护整个网络的一致性。

这是多线程区块链执行的巅峰——并行处理的性能和统一共识的安全性。