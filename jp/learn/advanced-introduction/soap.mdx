---

title: プロジェクト SOAP
description: Quai が補助金付きオープンマーケット取得プロトコル（SOAP）を通じてマージマイニングをトークン買い戻しへ変換する方法
------------------------------------------

ビットコインのマイナーは、1つのチェーンにハードウェアを向け、ブロックを解いて報酬を得るために競争しています。では、同じハードウェアを複数のチェーンに同時に向け、両方から報酬を得られるとしたらどうでしょう？ これがマージマイニング（merge-mining）の核心的な洞察です。マージマイニングは計算力を分割することなく、2つ以上のブロックチェーンを同時に採掘し、報酬を得られる技術です。

最も有名な例は Namecoin で、2011年からビットコインとマージマイニングされてきました。アイデアはエレガントです。ビットコインを採掘する際、ビットコインのブロックの coinbase 取引に Namecoin ブロックへの参照を含めます。ビットコインのブロックが有効なら、Namecoin のブロック報酬も同時に請求できます。つまり、1回の PoW 計算で2つのチェーンからクレジットを得るわけです。

その後、Litecoin と Dogecoin はより洗練されたバージョンを実装し、DOGE のマイナーが LTC を同時に採掘できるようにしました。これにより共生関係が生まれます。Dogecoin は Litecoin のハッシュレートからセキュリティを得て、Litecoin のマイナーは DOGE 報酬という追加収益を得ました。

しかし SOAP を着想させた機会はここにあります。従来のマージマイニングでは、マイナーは親チェーン（例：Bitcoin Cash）と子チェーン（例：Namecoin）のブロック報酬を直接自分のウォレットで受け取ります。つまり子チェーンはセキュリティのためにマイナーへ報酬を支払っているのに、マイナーはしばしば子チェーンのトークンを即座に売却し、継続的な売り圧力を生みます。

この流れを、永続的なプロトコル支援へ導けたらどうでしょう？

## SOAP 補助金モデル

SOAP はマージマイニングをプロトコル補助金メカニズムへ変換します。マイナーが親チェーンのブロック報酬を直接受け取る代わりに、SOAP は親チェーンの coinbase 出力の 100% をプロトコル管理アドレスへルーティングします。そのアドレスは市場で親チェーンのトークンを QUAI に交換し、買った QUAI を焼却（burn）するか、タイムロック付きステーキング報酬に回します。

こう考えてください。SOAP を有効にして QUAI を採掘しても、通常通り QUAI のブロック報酬を得られます。SOAP はそこを変えません。SOAP が追加するのは、他チェーン（BCH、LTC、DOGE、RVN）のハッシュレートを workshare/blocks の形で取り込み、プロトコル補助金を作れる能力です。SOAP 参加の経済的命題は明快です。あなたは QUAI を採掘し QUAI で報酬を受け取る一方、親チェーンのブロック補助金はプロトコルに入ります。

<Frame>
	<img src='/images/SOAP/SOAPFlows.png' />
</Frame>

QUAI だけに集中するマイナーにとっては何も変わりません。彼らは KawPow ブロックを採掘して QUAI を得ます。既存の BCH/LTC/DOGE ハードウェアを持つマイナーにとっては、SOAP が QUAI を稼ぐ新しい方法を提供します。SHA-256 や Scrypt リグを SOAP 対応プールに向ければ QUAI を採掘でき、マージマイニングされた BCH/LTC/DOGE は買い戻しの原資に使われます。

重要な洞察はこれです。SOAP は有効な親チェーンのマージマイニングを自動的に含め、継続的なプロトコル補助金を生み出します。マイナーは手元のどんなハードウェアでもセキュリティへ貢献でき、プロトコルはその労働に対して QUAI で公平に支払い、親チェーン補助金を永続的な買い圧力へ変換します。

最悪の場合、これは日次の正味フローがゼロになります。マイナーが QUAI を売り、プロトコルが親チェーン補助金で QUAI を買い、力が相殺されるからです。しかし実際には「非傭兵的（non-mercenary）」なマイナー（すぐに売らず保有する人）が存在するため、多くの日で QUAI に正味の買い圧力が生まれます。補助金チェーンによる買いが増える → 価格が改善 → ハッシュレートが増加 → QUAI のセキュリティが強化 → 補助金チェーンが SOAP をより魅力的に感じる → 補助金フローがさらに増える → さらに買い・焼却、という正のフィードバックが生じえます。

<Frame>
	<img src='/images/SOAP/SOAPInAction.png' />
</Frame>

**重要な注記：** これは約束ではなく、もっともらしい正のフィードバックループの仮説にすぎません。

## 技術構造：AuxPoW

Quai はどうやって、親チェーンのブロックが本当にプロトコルアドレスへ支払い、必要なコミットメントを含んだことを検証するのでしょう？ それが AuxPoW（auxiliary proof-of-work）構造です。

AuxPoW は SPV 形式の証明で、以下を含みます：

* 親チェーンの 80 バイトブロックヘッダ（KawPow は 120 バイト）
* そのブロックの coinbase 取引
* coinbase がブロックに含まれることを示す Merkle ブランチ
* どの親チェーン由来かを示すメタデータ（BCH、LTC、DOGE、KawPow など）

Quai ノードが AuxPoW を含むブロックを受け取ると、次のチェックを行います：

* **Merkle 検証：** coinbase 取引は親チェーンブロックの Merkle root に実際に含まれているか？
* **コミットメント検査：** coinbase の scriptSig に SOAP push が含まれているか？（具体的には "SOAP" の魔法バイト 0x01 に続く 32 バイトの Quai WorkObject ハッシュ）
* **支払い検査：** coinbase の第1出力が補助金＋手数料の100%をプロトコル指定アドレス（QADDR）に払っているか？
* **（任意）PoW 検証：** 親チェーンヘッダがそのチェーンの難易度ターゲットを満たすか？

SOAP のコミットメントは coinbase の scriptSig に置かれ、BIP34 の高さ push の直後に入ります。この配置が重要なのは、scriptSig がマイナーの coinbase 構築に普遍的に存在し、特殊な OP_RETURN 処理やポリシー差異を気にせず、全 SOAP 親チェーンで共有できるからです。

コミットメント形式は最小限です：

* PUSHDATA(BIP34_height)
* PUSHDATA("SOAP" 0x01 || 32-byte WO_HASH)
* PUSHDATA(extranonce1)
* PUSHDATA(extranonce2)

マイナーは従来通り extranonce2 を変化させ、プールは extranonce1 を提供し、SOAP push はプールのジョブテンプレートで固定されます。つまり標準の Stratum v1 採掘はファームウェア変更なしで動作します。プールは workshare 報酬を受け取る QUAI の支払いアドレスを指定し、親チェーンの coinbase 構築（QADDR 支払いと SOAP コミットメントを含む）は Quai ノード自身が処理します。

<Frame>
	<img src='/images/SOAP/QuaiPools.png' />
</Frame>

## Workshares とマルチアルゴリズム採掘

ここから SOAP がプロトコル設計として面白くなります。Quai ブロックは KawPow マイナーだけが作成でき、他のアルゴリズムは Quai ブロックを生成できません。しかし他のアルゴリズム（BCH の SHA-256、LTC/DOGE の Scrypt、そして KawPow 自身）は workshare を提出でき、それが KawPow ブロックに含まれて QUAI 報酬を得られます。

Quai が workshare を開発した目的は、セルフィッシュマイニングの防止と、より速いファイナリティ収束のためのハッシュレートサンプル提供でしたが、その仕組みは自然に KawPow 以外の PoW アルゴリズムを支える土台になります。

ビットコイン式インセンティブ整合の核心は、「ハッシュ試行は観測できず、ブロック生成だけ観測できるとき、どうやって作業量に比例した報酬を保証するか？」です。すべての nonce 試行を提出させるのは高コストすぎます。採掘プールは、より易しい難易度目標を満たす share（k-サブブロック）を提出させ、その数に応じて支払います。

Quai はこれを workshare としてオンチェーン化します。ただし従来のオフチェーン share と異なり、Quai の workshare は以下の条件を満たす WorkObject です：

* Quai のブロック難易度を **満たさない**（KawPow ブロックではない）
* 親チェーン参加を示す有効な AuxPoW を **含む**
* WorkObject の parentHash によって現在の Quai tip へ **コミットする**

各 workshare は「私はチェーン X（BCH/LTC/DOGE/RVN）で計算し、Quai WorkObject Y を参照し、親チェーン coinbase が QADDR に支払った」ことを証明します。workshare 自体は新しい Quai ブロックを作りませんが、WorkObject の primaryCoinbase に指定されたアドレスへ QUAI 支払いを発生させます。

KawPow ブロックの提案者はブロックあたり最大 9 つの workshare を含められ（ハードキャップ）、別の難易度調整により 1 ブロックあたり 3 件程度のソフト目標が保たれます。各アルゴリズム（SHA-256、Scrypt、KawPow）には独自の share 難易度があり、どれか一つが支配しないようにしています。

このマルチアルゴリズム方式の利点は：

* **ハードウェア多様性：** 異なるアルゴリズムの ASIC が別々の供給網でセキュリティに貢献するため、単一メーカーや特定ハードウェアの支配が難しくなる。
* **補助金変換のスケーラビリティ：** KawPow ブロックが目標レートで産出されていても、workshare によって Quai のブロックタイミングや難易度を乱さず、親チェーン参加を拡大できる。

## Workshares は重みを増やしセキュリティを提供する

workshare は Quai コンセンサスにおけるブロック重み（weight）と経済的ファイナリティに直接寄与します。ブロック重みは単なるブロック数ではなく、チェーンを守る総計算作業量を反映するエントロピー測定です。これは PoEM と Proportional Reward Splitting（PRS）によって測定され、SOAP 以前から Quai に存在していました。

ブロックの総エントロピー（重み）を計算する際、プロトコルは：

* PoW 解からブロック固有のエントロピーを算出し
* 含まれた workshare のエントロピーを加算（最大 9 件）
* 割引ルールを適用します：

  * ブロック難易度未満の workshare は重みが減衰
  * 古いブロックを指す workshare は距離に応じ指数的に減衰

SHA-256 と Scrypt の workshare を含む KawPow ブロックは、含まない同等のブロックより明確に重くなります。重いブロックは再編（reorg）しにくくなり、経済的ファイナリティが速くなります。

経済的ファイナリティは再編コストに依存します。攻撃者は正直なチェーンより多い総エントロピーを生成しなければなりません。workshare があると：

* 各ブロックが KawPow 単独より多いエントロピーを蓄積
* 再編攻撃が比例的に高コスト化
* マルチアルゴリズム安全性が複合的に強化（攻撃者は複数アルゴリズムのハッシュレートが必要、もしくは workshare 分を上回る追加 KawPow 作業が必要）

**例：** 1000 の KawPow エントロピーに 200 の workshare エントロピー（SHA-256 150、Scrypt 50）が加わると総計 1200。攻撃者は KawPow のみのチェーンより 20% 余計に作業しないと再編できません。

## なぜマイナーが参加するのか

それでも疑問が残ります。なぜ BCH のマイナーが自分のブロック報酬を QADDR に送ってしまうのでしょう？

答えは 2 種類の参加者に分かれます。

**親チェーン（BCH/LTC/DOGE/RVN）の workshare 提出マイナー：**
workshare 提出量に比例して、Quai の発行スケジュールから QUAI 報酬を受け取ります。親チェーンのブロック報酬はプロトコルに行きますが、QUAI 支払いが補償します。さらに workshare は Quai の合意を強め、ファイナリティを加速する追加ハッシュレートサンプルとして機能します。収益性は以下に依存します：

* QUAI 価格と親チェーン価格の相対関係
* Quai の workshare 報酬率
* workshare 同士の包含競争（ブロックあたり最大 9 件）

**Quai の KawPow ブロック生産者：**
通常の QUAI ブロック報酬を受け取ります。KawPow で直接 Quai を守りつつ、プロトコルが BCH/LTC/DOGE 補助金を QUAI に換えて買い続けることで生じる SOAP の買い圧力の恩恵を受けます。

このダイナミクスは魅力的です。親チェーンマイナーは収益多角化（SOAP 以外では自チェーン報酬、SOAP では QUAI）を得て、Quai は外部セキュリティと永続的買い圧力を得ます。そして伝統的マージマイニングによる継続的売り圧力を回避できます。

## ガバナンスとローテーション

実務上の懸念：ネットワーク全体のハードフォークなしに QADDR や SOAP パラメータをどう更新するか？

Quai は委員会ベースのガバナンスを使い、少数の署名者が AuxTemplate を作成・署名します。AuxTemplate は以下を指定します：

* 親チェーン種別（ChainID）
* 必須の支払いスクリプト（PayoutScript = QADDR）
* 直前ブロックのハッシュ（PrevHash）
* ScriptSig の長さ制限
* 参考採掘パラメータ（nBits、nTime マスク等）

テンプレートは閾値数の委員会署名（例：2-of-3 マルチシグ）で有効化され、Quai の合意はブロックに含まれる AuxPoW がクオラム署名済みテンプレートに一致することを要求します。

これによりプロトコルは：

* 鍵漏洩時に QADDR をローテーション
* 親チェーン参加のパラメータ調整
* 対応親チェーンの追加・削除

をハードフォークなしで行えます。委員会構造は現行の採掘中央化も改善します。親チェーン採掘は大規模プールの単一点支配が強い一方、SOAP はプール運営者の単独信頼を、複数署名者の委員会へ置き換えて信頼を分散します。

さらに重要なのは、Quai のブロック提案は各ノードでローカル生成される点です。親チェーンの信頼モデルは既存プール支配と同等かそれ以上になり、Quai の分散性は一切変わりません。委員会は支払い先や基本パラメータを指定するテンプレートを署名するだけで、ブロック生成の自律性はノード側に残ります。

## セキュリティとライブネス

最後にセキュリティモデルについて。SOAP は「優雅に失敗する」よう設計されています。親チェーン参加がゼロになっても（BCH/LTC/DOGE/KawPow マイナーが workshare を提出しなくなっても）、Quai は通常通り KawPow ブロックを生産し続けます。ライブネスの結合はありません。workshare は純粋な加算要素です。

これは、子チェーンが親チェーンに依存する一部のマージマイニング構成と対照的です。（もし Quai ブロックに親チェーン AuxPoW の包含を必須にしたら、Quai のライブネスを親チェーンの出ブロックに結び付けてしまい、脆弱になります。）

SOAP の哲学はこうです。外部参加があるときは利益を得るが、外部が来なくても壊れない。

実際のセキュリティ向上は、ハードウェア基盤の多様化と、マイナーのインセンティブを Quai の成功と整合させる経済設計から生まれます。それが十分かどうかは、市場で実証される経験的な問題であり、ホワイトペーパーで証明できるものではありません。

## まとめ

SOAP は親チェーン補助金をプロトコル管理アドレスに送らせ、QUAI を買い戻すことで、従来のマージマイニングをプロトコル補助金メカニズムへ転換します。買い戻された QUAI は主に（1）焼却、または（2）QUAI をロックするユーザーへの報酬（ステーキングのような仕組み）に使われます。これにより、外部マイナーは workshare で QUAI を稼げる一方、継続的な買い圧力が生まれます。

技術的には、SOAP は AuxPoW 構造で親チェーン参加を証明し、標準採掘インフラとの互換性のため coinbase の scriptSig にコミットメントを配置します。Quai ブロックは KawPow のみ（ProgPoW から移行中）で生成されますが、他アルゴリズム（SHA-256、Scrypt、KawPow 自身）の workshare を含めて QUAI 報酬を支払い、異なるハードウェアクラスでセキュリティを分散します。

workshare メカニズムは FruitChains と PRS に基づき、採掘プールが貢献度推定に用いる統計的サンプリング手法をオンチェーン化します。

SOAP の成功は市場メカニクス次第です。マイナーが QUAI 報酬を競争力あると感じるか、そして十分な「非傭兵的」ハッシュレートが純買い圧力を生めるかにかかっています。プロトコルは外部チェーン（BCH、LTC、DOGE）のセキュリティを市場価格で購入し、その補助金を継続的な QUAI の買いへ変換します。これは子チェーンが純粋な売り圧力に悩む従来のマージマイニング経済を反転させ、外部補助金をプロトコルトレジャリーの流入として流動性支援に使いながら、マイナーには公正な QUAI 補償を与える仕組みです。
