---
title: 外部トランザクション（ETX）
description: Quai Networkでクロスチェーントランザクションがいかに処理されるか
---

## 外部トランザクションの理解

ほとんどのブロックチェーンネットワークでは、チェーン間でアセットを移動することは、ラップトークン、ブリッジオペレーター、および重大な信頼前提を含む複雑なプロセスです。ユーザーはしばしばブリッジハックで資金を失ったり、長い遅延を経験したり、過度な手数料を支払ったりします。Quai Networkの外部トランザクション（ETX）は、ブロックチェーンが通信する方法の根本的な再考を表します。

ETXは、外部依存なしにQuaiゾーン間で価値を移動するネイティブクロスチェーントランザクションです。これらのトランザクションは、すべてのチェーンを同期させるのと同じハッシュリンク参照を活用し、通常のオンチェーン転送と同じくらい安全にします。ブリッジオペレーターなし、ラップトークンなし、信頼前提なし - 純粋な暗号学的保証のみです。

**ETXの旅：**
すべてのETXは、Quaiの階層を通じて決定論的パスをたどります。川システムを流れる水のように、トランザクションは常に合流点（支配的チェーン）まで上がってから、宛先まで流れ戻ります。この予測可能なルーティングにより、効率性を維持しながらセキュリティが保証されます。

ETXは常に階層内の支配的チェーン（リージョンチェーンまたはプライムチェーンのいずれか）を通過します。以下の図は、これら2つのルーティングパターンを示しています：

<Frame>
	<img src='/images/Cross-Prime-TXNS.png' />
</Frame>

<Frame>
	<img src='/images/Cross-Region-TXNS.png' />
</Frame>

## ETXのネットワーク内での移動方法

ETXがQuaiの階層をどのように移動するかを理解することは、開発者とユーザーの両方にとって重要です。システムは安全かつ効率的になるよう設計され、ネットワークにボトルネックを作ることなく、クロスチェーン転送が確実に完了することを保証します。

各ETXは、「オリジンチェーン」と呼ばれるもので旅を始めます - トランザクションが開始されるゾーンです。最終目的地は適切に「宛先チェーン」と呼ばれます。これら2つのポイント間で、トランザクションは特定のパスをたどります：階層を上がって共有支配的チェーンに到達し、その後宛先まで戻ります。このルーティングは宛先アドレスに基づいて自動的に行われます。

**2つのタイプのクロスチェーン操作：**
Quaiは、それぞれ異なる用途に対応する2つの異なるタイプのETXをサポートします：
1. **アカウント開始ETX**：ゾーン間でアセットを送信する一般ユーザー
2. **コントラクト開始ETX**：プログラム的にクロスチェーン操作をトリガーするスマートコントラクト

**革新による効率性：**
従来のクロスチェーンシステムは各トランザクションを個別に処理し、大きなオーバーヘッドを作り出します。Quaiは、ブロックヘッダーでETXデータをバッチ処理する革新的なロールアップメカニズムを実装しています。この前方伝播システムは、処理要件を30倍以上削減し、渋滞なしで大量のクロスチェーンボリュームを処理することをネットワークに可能にします。これは、個々の配送のために個別のボートを送る代わりに、多くのパッケージを運ぶ貨物船のようなものです。

## アカウント開始ETX：ユーザー転送

アカウント開始ETXは、最も一般的なタイプのクロスチェーントランザクション - ユーザーがゾーン間でアセットを移動すること - を表します。これらのトランザクションは、合理的な速度を維持しながらセキュリティを保証する予測可能な2フェーズプロセスをたどります。このプロセスを理解することで、ユーザーはクロスチェーン転送に対して適切な期待を設定できます。

旅は、ユーザーが異なるゾーンのアドレスへの転送を開始することから始まります。ネットワークは宛先アドレス形式に基づいてこれをクロスチェーン操作として自動認識し、ETXプロセスを開始します。ユーザーの観点から、彼らは単に受取人アドレスと金額を指定するだけです - 複雑さは完全にプロトコルによって処理されます。

### フェーズ1：階層を上る

最初のフェーズは、宛先ゾーンと調整できるチェーンに到達するまで、ネットワーク階層を通じてトランザクションデータを上に移動することを含みます。この上向き伝播は以下のステップに従います：

1. **初期ブロードキャスト**：トランザクションが標準内部トランザクションとしてオリジンゾーンに送信される
2. **ローカル処理**：オリジンゾーンのマイナーがトランザクションをブロックに含め、送信者から残高を削除し、1つ以上のETXを作成
3. **上向き伝播**：ETXデータが階層内の支配的チェーンに転送される
4. **コインシデントブロック収集**：コインシデントブロックが発生すると、支配的チェーンが下位ゾーンからすべての保留中ETXを収集
5. **継続的エスカレーション**：宛先がより高いチェーン（プライムなど）を通じた調整を必要とする場合、プロセスが上向きに繰り返される

### フェーズ2：客観的標準化と配信

ETXが調整ポイントに到達すると、客観的標準化の重要なプロセスが始まります。このフェーズは、有効で標準的なETXのみが実行されることを保証するために、Quaiのハッシュリンク参照システムを活用します：

1. **ハッシュリンク参照作成**：コインシデントブロックが見つかると、同じ場所からの最後のコインシデントブロック以降の各ブロックの下位マニフェストの各ハッシュから保留中ETXが収集される
2. **客観的標準化**：現在のチェーンまたは下位チェーン宛のすべてのETXが特定され、これらの客観的ハッシュリンク証明を通じて参照可能になる
3. **事前計算状態伝播**：標準化されたETXが宛先チェーンに伝播され、保留中ETXセットに追加されてマイニング可能になる
4. **証明付き最終実行**：客観的ハッシュ参照が発行されたETXの標準化を証明した後にのみ、ETXが宛先チェーンのブロックに含まれ、受信アドレスに残高が追加される

このプロセスにより、すべてのクロスチェーン転送が信頼ベースの前提ではなく、有効性の数学的証明とともに、ローカルトランザクションと同じセキュリティ保証を維持することが保証されます。全プロセスは通常、暗号学的確実性を提供しながら数分以内に完了します。

## コントラクト開始ETX：スマートコントラクト相互作用

コントラクト開始ETXにより、スマートコントラクトがプログラム的にクロスチェーン操作をトリガーでき、洗練されたマルチチェーンアプリケーションが解放されます。プロセスは、セキュリティを保証するのと同じ客観的ハッシュリンク参照システムを活用しますが、クロスチェーン操作が必要なタイミングを決定するためにスマートコントラクトロジックを追加します。

### フェーズ1：スマートコントラクトロジックと上向き伝播

スマートコントラクトは、クロスチェーン決定を行い、必要に応じてETXを発行するために特殊なオペコードを使用します：

1. **コントラクト相互作用開始**：ユーザーがコントラクト関数を呼び出し、アドレスの地理的性を確認するISADDRINTERNAL便利オペコードを潜在的にトリガー
2. **クロスチェーン決定**：ISADDRINTERNALがFALSE（クロスチェーンアドレスを示す）を返すか、他のコントラクトロジックがトリガーされた場合、コントラクトはOP_ETXを使用してETXを発行
3. **階層伝播**：ETXが階層内の支配的ピアに伝播される
4. **コインシデントブロック収集**：コインシデントブロックが見つかると、支配的ピアが下位マニフェストリンケージを通じてすべての保留中ETXを収集
5. **継続的エスカレーション**：宛先チェーンが支配的チェーン（つまり、リージョンチェーン）を持つ場合、ステップ3と4が上向きに繰り返される

### フェーズ2：客観的標準化と実行

下向きフェーズは、ETX有効性を保証するQuaiのユニークな客観的ハッシュ参照システムに依存します：

1. **ハッシュリンク参照作成**：コインシデントブロックが発生すると、最後のコインシデントブロック以降の各ブロックの下位マニフェストの各ハッシュから保留中ETXが収集される
2. **客観的標準化**：現在のチェーンまたは下位チェーン宛のETXが特定され、これらのハッシュリンク証明を通じて参照可能になる
3. **事前計算状態可用性**：保留中ETXが宛先チェーンに伝播され、保留中ETXセットに追加されてマイニング可能になる
4. **証明付き最終実行**：客観的ハッシュ参照が発行されたETXの標準化を証明した後にのみ、ETXが宛先チェーンブロックに含まれる

このシステムにより、コントラクト開始クロスチェーン操作が、複雑なマルチチェーンアプリケーションロジックを可能にしながら、ローカルトランザクションと同じセキュリティ保証を維持することが保証されます。

## ETXロールアップの前方伝播

Quaiの重要な革新の1つは、大量のクロスチェーントランザクションを処理する効率性です。従来のシステムは各クロスチェーン操作を個別に処理し、重大な計算オーバーヘッドを作り出します。Quaiは、ETXデータをバッチ処理し事前処理する洗練されたロールアップメカニズムを実装し、セキュリティを維持しながら計算要件を30倍以上削減します。

**ブロックヘッダーデータフィールド：**
各Quaiブロックヘッダーには、ETX管理のための2つの特殊フィールドが含まれています：
- **etxTransactions**：ハッシュのリスト。各ハッシュはその特定のブロックから発行されたユニークなETXを表す
- **etxRollupRoot**：前のコインシデントブロック以降に発行されたすべてのETXの累積ロールアップを表す単一のハッシュ

**事前計算状態遷移：**
etxRollupRootフィールドは、ローカルコンセンサスの各ポイントでブロックチェーンを調整するために伝播され、宛先チェーンがETXが標準化される前に状態遷移を事前計算することを可能にします。この準備により、ETXが最終的に実行のために到着した際の処理時間が劇的に短縮されます。

**重要なセキュリティ制約：**
事前計算された状態遷移は、オリジンと宛先チェーン間の客観的ハッシュリンク参照が提供されるまで、参照可能または標準化されないことを理解することが重要です。これにより、標準的なETXのみがチェーン状態に影響を与えることができ、無効または不正なクロスチェーン操作の可能性を防ぎます。

**下位ブロックマニフェスト：**
ハッシュリンク参照は、下位ブロックマニフェスト（subManifest）と呼ばれる特殊なデータフィールドを通じて作成されます。このフィールドは通常のブロックでは空のままですが、コインシデントブロックで重要になり、前のコインシデントブロック以降に生成されたすべての下位ブロックハッシュの完全なリストを含みます。これにより、各支配的ブロックチェーン内のすべての下位ブロックへの直接的で客観的な参照が作成され、Quai Network全体を保護するハッシュリンク参照が確立されます。

ハッシュリンク参照が事前計算された遷移セットを受け取った調整コンテキストに提供された瞬間、ETXは標準的に検証可能になり、状態遷移が参照可能で実行可能になります。このシステムは、クロスチェーン操作のための効率性とセキュリティの完璧なバランスを提供します。